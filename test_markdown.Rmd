---
title: "Interactive Review Graphics"
author: "Veronica Pagowski"
date: "2024-03-08"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Big Disjunctions
<style>
.layout-container {
    display: space-between; /* Use flexbox for layout */
    align-items: flex-start; /* Align items to the start (left) of the flex container */
    margin-left: -300px;
}

.graph-container {
    display: space-between; /* Display graphs as inline-block to ensure they are in a row */
    width: 33%; /* Each graph container takes one-third of the width */
    margin-right: 20px; /* Adjust margin as needed */
    margin-left: 0px;
    top: 0; 
    bottom: 0;
    padding: 0; 
}
.graph-container h2 {
    position: absolute;
    align-items: flex-start; 
    margin-left: 440px; /* Reset margin for titles */
    width: 100%;
    top: 220px; 
    bottom: 0;
    padding: 0; 
    font-style: italic; /* Make the font italicized */
    font-size: 25px; /* Set smaller font size */
}

.graph-container h3 {
    position: absolute;
    align-items: flex-start; 
    margin-left: 440px; /* Reset margin for titles */
    width: 100%;
    top: 800px; 
    bottom: 0;
    padding: 0; 
    font-style: italic; /* Make the font italicized */
    font-size: 25px; /* Set smaller font size */
}
</style>


```{r eval =TRUE, echo=FALSE, message = FALSE, warning = FALSE,fig.align = 'left' }
setwd("~/Desktop/Review")
ref_data <- read.csv("rayyan_references_included_chords2.csv", header = TRUE)

###Associations plots
library(tidyverse)
library(chorddiag)
library(htmlwidgets)
library(gdata)
library(htmltools)
df<- read.csv("articles.csv", header = TRUE)
df<-df %>% 
  filter(str_detect(Category, pattern = "nogap",negate=TRUE))

############## BIG SPATIAL SCALES ONLY ##############
dfb<-df %>% 
  filter(str_detect(Category, pattern = "K"))
#Spatial = S, Community = C, Genetic = G
# Small-scale = J, Big = K

#Get spatial gap matrix
spatialb1<-dfb %>% 
  filter(str_detect(Category, pattern = "S") & !str_detect(Category, pattern = "G"))
out_spatialb1 <- crossprod(table(subset(stack(setNames(lapply(strsplit(spatialb1$Category, "[][]|,\\s*"), trimws), spatialb1$Id))[2:1], nzchar(values))))
diag(out_spatialb1) <- 0
out_spatialb1 <- out_spatialb1[, !colnames(out_spatialb1) %in% c("U","M")] 
out_spatialb1 <- out_spatialb1[!rownames(out_spatialb1) %in% c("U","M"),]

#Arrange 
custom_order<-c("V","O","H","I","E","B","T","C","S")
out_spatialb1 <- out_spatialb1[custom_order, custom_order]
out_spatialb1[upper.tri(out_spatialb1)] <- NA
upperTriangle(out_spatialb1) = lowerTriangle(out_spatialb1, byrow=TRUE)

#get genetic gap matrix
geneticb1<-dfb %>% 
  filter(str_detect(Category, pattern = "G") & !str_detect(Category, pattern = "S"))
out_genb1 <- crossprod(table(subset(stack(setNames(lapply(strsplit(geneticb1$Category,  "[][]|,\\s*"), trimws), geneticb1$Id))[2:1], nzchar(values))))
diag(out_genb1) <- 0
out_genb1 <- out_genb1[, !colnames(out_genb1) %in% c("U","M")] 
out_genb1 <- out_genb1[!rownames(out_genb1) %in% c("U","M"),]
#Arrange 
custom_order<-c("V","O","G")
out_genb1 <- out_genb1[custom_order, custom_order]
out_genb1[upper.tri(out_genb1)] <- NA
upperTriangle(out_genb1) = lowerTriangle(out_genb1, byrow=TRUE)


#get both gap matrix
bothb1 <- dfb %>%
  filter(str_detect(Category, pattern = "G") & str_detect(Category, pattern = "S"))
out_bothb1 <- crossprod(table(subset(stack(setNames(lapply(strsplit(bothb1$Category, "[][]|,\\s*"), trimws), bothb1$Id))[2:1], nzchar(values))))
diag(out_bothb1) <- 0
out_bothb1 <- out_bothb1[, !colnames(out_bothb1) %in% c("U","M")] 
out_bothb1 <- out_bothb1[!rownames(out_bothb1) %in% c("U","M"),]
#Arrange 
custom_order<-c("V","O","H","I", "E","L","B","T","Sx","F","W","G","S")
out_bothb1 <- out_bothb1[custom_order, custom_order]

#Make interactive plots


##Spatial
#add white columns that are blank to spatially separate diagram
cols_s <- c("#FFBBFF","#B3EE3A","#D02090","#8B2323", "#F0E442","#CD5555", "#009E73","white","white","white","white","white","white","#8B008B","#404040","white","white","white","white","white","white")

ad <- rep(0,7)
out_spatialb2 = cbind(out_spatialb1[,c(1:7)],ad,ad,ad,ad,ad,ad,out_spatialb1[,c(8:9)],ad,ad,ad,ad,ad,ad)
out_spatialb2 = rbind(out_spatialb2[c(1:7),],ad,ad,ad,ad,ad,ad,out_spatialb2[c(8:9),],ad,ad,ad,ad,ad,ad)

p1 <- chorddiag(out_spatialb2, groupColors = cols_s, showGroupnames = FALSE,groupPadding = 2,showTooltips = FALSE,tickInterval=10,ticklabelFontsize=0)

##Genetic
#add white columns that are blank to spatially separate diagram
cols_gb <- c("#FFBBFF","#B3EE3A", "white","white","white","white","white","white","#00008B","white","white","white","white","white","white")
ad <- rep(0,2)
out_genb2 = cbind(out_genb1[,c(1:2)],ad,ad,ad,ad,ad,ad,out_genb1[,c(3)],ad,ad,ad,ad,ad,ad)
out_genb2 = rbind(out_genb2[c(1:2),],ad,ad,ad,ad,ad,ad,out_genb2[c(3),],ad,ad,ad,ad,ad,ad)

p2 <- chorddiag(out_genb2, groupColors = cols_gb, showGroupnames = FALSE,groupPadding = 2,showTooltips = FALSE,tickInterval=10,ticklabelFontsize=0)
#q

#Both
cols_b <- c("#FFBBFF","#B3EE3A","#D02090","#8B2323","#F0E442", "#3A5FCD", "#CD5555","#009E73","#FFA07A","#6EE2FF","#FF7F24", "white","white","white","white","white","white","#00008B","#404040","white","white","white","white","white","white")

ad <- rep(0,13)
out_bothb2 = cbind(out_bothb1[,c(1:11)],ad,ad,ad,ad,ad,ad,out_bothb1[,c(12:13)],ad,ad,ad,ad,ad,ad)
out_bothb2 = rbind(out_bothb2[c(1:11),],ad,ad,ad,ad,ad,ad,out_bothb2[c(12:13),],ad,ad,ad,ad,ad,ad)

p3 <- chorddiag(out_bothb2, groupColors = cols_b, showGroupnames = FALSE,groupPadding = 2,showTooltips = FALSE,tickInterval=10,ticklabelFontsize=0)


custom_css <- "
<style>
.layout-container {
    display: flex;
    flex-direction: row;
    justify-content: space-between; /* Adjust alignment as needed */
}

.graph-container {
    flex: 1;
    margin: 0px; /* Adjust margin as needed */
    width: 30%; /* Adjust width of each graph container */
}
</style>
"

# Define titles for each graph
title_p1 <- "Spatial"
title_p2 <- "Genetic"
title_p3 <- "Both"

# Create div layout with custom CSS and titles
layout <- tags$div(
  class = "layout-container",
  tags$div(
    class = "graph-container",
    tags$h2(title_p1),  # Add title for graph p1
    p1
  ),
  tags$div(
    class = "graph-container",
    tags$h2(title_p2),  # Add title for graph p2
    p2
  ),
  tags$div(
    class = "graph-container",
    tags$h2(title_p3),  # Add title for graph p3
    p3
  ),
  HTML(custom_css)
)
layout
setwd("/Users/veronicapagowski/Desktop/interactive_app/interactive_review")
#saveWidget(p, "chord_test2.html", selfcontained = TRUE, knitrOptions = list())


```


## Small Disjunctions
```{r eval =TRUE, echo=FALSE, message = FALSE, warning = FALSE }

############## SMALL SPATIAL SCALES ONLY ##############
dfs<-df %>% 
  filter(str_detect(Category, pattern = "J"))
#Spatial = S, Community = C, Genetic = G
# Small-scale = J, Big = K

#Get spatial gap matrix
spatial1<-dfs %>% 
  filter(str_detect(Category, pattern = "S") & !str_detect(Category, pattern = "G"))
out_spatial1 <- crossprod(table(subset(stack(setNames(lapply(strsplit(spatial1$Category, 
                                                                      "[][]|,\\s*"), trimws), spatial1$Id))[2:1], nzchar(values))))
diag(out_spatial1) <- 0
#remove U and M category (misc. and unknown)
out_spatial1 <- out_spatial1[, !colnames(out_spatial1) %in% c("U","M")] 
out_spatial1 <- out_spatial1[!rownames(out_spatial1) %in% c("U","M"),]

#Arrange 
custom_order<-c("V","O","H","I","E","B","T","C","S")
out_spatial1 <- out_spatial1[custom_order, custom_order]
out_spatial1[upper.tri(out_spatial1)] <- NA
upperTriangle(out_spatial1) = lowerTriangle(out_spatial1, byrow=TRUE)

#get genetic gap matrix
genetic1<-dfs %>% 
  filter(str_detect(Category, pattern = "G") & !str_detect(Category, pattern = "S"))
out_gen1 <- crossprod(table(subset(stack(setNames(lapply(strsplit(genetic1$Category,  "[][]|,\\s*"), trimws), genetic1$Id))[2:1], nzchar(values))))
diag(out_gen1) <- 0
out_gen1 <- out_gen1[, !colnames(out_gen1) %in% c("U","M")] 
out_gen1 <- out_gen1[!rownames(out_gen1) %in% c("U","M"),]
#Arrange 
custom_order<-c("V","O","H","I","L","B","T","F","G")
out_gen1 <- out_gen1[custom_order, custom_order]
out_gen1[upper.tri(out_gen1)] <- NA
upperTriangle(out_gen1) = lowerTriangle(out_gen1, byrow=TRUE)


#get both gap matrix
both1 <- dfs %>%
  filter(str_detect(Category, pattern = "G") & str_detect(Category, pattern = "S"))
out_both1 <- crossprod(table(subset(stack(setNames(lapply(strsplit(both1$Category, "[][]|,\\s*"), trimws), both1$Id))[2:1], nzchar(values))))
diag(out_both1) <- 0
out_both1 <- out_both1[, !colnames(out_both1) %in% c("U","M")] 
out_both1 <- out_both1[!rownames(out_both1) %in% c("U","M"),]
#Arrange 
custom_order<-c("V","O","H","I","L","B","T","Sx","F","W","G","S")
out_both1 <- out_both1[custom_order, custom_order]

#Make interactive plots


##Spatial
#add white columns that are blank to spatially separate diagram
cols_s <- c("#FFBBFF","#B3EE3A","#D02090","#8B2323", "#F0E442","#CD5555", "#009E73","white","white","white","white","white","white","#8B008B","#404040","white","white","white","white","white","white")

ad <- rep(0,7)
out_spatial2 = cbind(out_spatial1[,c(1:7)],ad,ad,ad,ad,ad,ad,out_spatial1[,c(8:9)],ad,ad,ad,ad,ad,ad)
out_spatial2 = rbind(out_spatial2[c(1:7),],ad,ad,ad,ad,ad,ad,out_spatial2[c(8:9),],ad,ad,ad,ad,ad,ad)

p1 <- chorddiag(out_spatial2, groupColors = cols_s, showGroupnames = FALSE,groupPadding = 2,showTooltips = FALSE,tickInterval=10,ticklabelFontsize=0)
#p

##Genetic
#add white columns that are blank to spatially separate diagram
cols_g <- c("#FFBBFF","#B3EE3A","#D02090","#8B2323", "#3A5FCD", "#CD5555","#009E73","#6EE2FF", "white","white","white","white","white","white","#00008B","white","white","white","white","white","white")
ad <- rep(0,8)
out_gen2 = cbind(out_gen1[,c(1:8)],ad,ad,ad,ad,ad,ad,out_gen1[,c(9)],ad,ad,ad,ad,ad,ad)
out_gen2 = rbind(out_gen2[c(1:8),],ad,ad,ad,ad,ad,ad,out_gen2[c(9),],ad,ad,ad,ad,ad,ad)

p2 <- chorddiag(out_gen2, groupColors = cols_g, showGroupnames = FALSE,groupPadding = 2,showTooltips = FALSE,tickInterval=10,ticklabelFontsize=0)
#q

#Both
cols_b <- c("#FFBBFF","#B3EE3A","#D02090","#8B2323", "#3A5FCD", "#CD5555","#009E73","#FFA07A","#6EE2FF","#FF7F24", "white","white","white","white","white","white","#00008B","#404040","white","white","white","white","white","white")

ad <- rep(0,12)
out_both2 = cbind(out_both1[,c(1:10)],ad,ad,ad,ad,ad,ad,out_both1[,c(11:12)],ad,ad,ad,ad,ad,ad)
out_both2 = rbind(out_both2[c(1:10),],ad,ad,ad,ad,ad,ad,out_both2[c(11:12),],ad,ad,ad,ad,ad,ad)

p3 <- chorddiag(out_both2, groupColors = cols_b, showGroupnames = FALSE,groupPadding = 2,showTooltips = FALSE,tickInterval=10,ticklabelFontsize=0)

custom_css <- "
<style>
.layout-container {
    display: flex;
    flex-direction: row;
    justify-content: space-between; /* Adjust alignment as needed */
}

.graph-container {
    flex: 1;
    margin: 0px; /* Adjust margin as needed */
    width: 30%; /* Adjust width of each graph container */
}
</style>
"

# Define titles for each graph
title_p1 <- "Spatial"
title_p2 <- "Genetic"
title_p3 <- "Both"

# Create div layout with custom CSS and titles
layout2 <- tags$div(
  class = "layout-container",
  tags$div(
    class = "graph-container",
    tags$h3(title_p1),  # Add title for graph p1
    p1
  ),
  tags$div(
    class = "graph-container",
    tags$h3(title_p2),  # Add title for graph p2
    p2
  ),
  tags$div(
    class = "graph-container",
    tags$h3(title_p3),  # Add title for graph p3
    p3
  ),
  HTML(custom_css)
)
layout2
setwd("/Users/veronicapagowski/Desktop/interactive_app/interactive_review")

```

